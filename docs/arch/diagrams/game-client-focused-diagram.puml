@startuml
!includeurl https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

LAYOUT_WITH_LEGEND()

Container_Boundary(gameBoundary, "Game Client (Bevy)") {
    Component(connManager, "Connection Manager", "Establishes WebSocket connection to controller and manages reconnection logic")
    Component(wsHandler, "WebSocket Handler", "Receives binary frames and forwards to FlatBuffers Parser")
    Component(flatbuffersParser, "FlatBuffers Parser", "Parses incoming FlatBuffers frames into PoseFrame structs")
    Component(poseResource, "Pose ECS Resource & Event Dispatcher", "Stores latest pose and emits events for updates")
    Component(choreographyLoader, "Pre-Recorded Choreography Loader", "Loads and deserializes prerecorded pose sequences from disk")
    Component(matcher, "Pose Matcher / Score Evaluator", "Compares live pose against prerecorded choreography and updates score")
    Component(visualizer, "Visualization System", "Renders live and prerecorded 2D poses and displays score")
    Component(uiHandler, "User Interface & Input Handler", "Handles user inputs and maps them to ECS events")
    Component(configLoader, "Configuration & Settings Loader", "Loads configuration (e.g. WS address, TLS settings) into resources")
    Component(loggingDiagnostics, "Logging & Diagnostics", "Captures runtime events and exposes metrics for debugging")
    Component(errorHandling, "Error Handling & Recovery", "Handles errors and coordinates recovery across subcomponents")
    Component(resourceManager, "Resource Manager", "Manages asset loading and unloading to prevent stalling")
}

Rel(wsHandler, flatbuffersParser, "Forwards raw bytes")
Rel(flatbuffersParser, poseResource, "Creates PoseFrame objects")
Rel(poseResource, matcher, "Sends PoseUpdated event")
Rel(choreographyLoader, matcher, "Provides prerecorded choreography")
Rel(matcher, visualizer, "Updates visual content and score")
Rel(configLoader, connManager, "Provides WS settings")
Rel(connManager, wsHandler, "Sends and receives WebSocket frames")
Rel(loggingDiagnostics, errorHandling, "Logs errors and metrics")
Rel(errorHandling, connManager, "Triggers reconnection or alerts")
Rel(uiHandler, choreographyLoader, "Triggers load choreography events")
Rel(resourceManager, visualizer, "Provides assets for rendering")
@enduml

